<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>RoyalLoanPlanner: A coding Challenge</title>

		<!-- Bootstrap CSS -->
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
			rel="stylesheet"
			integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
			crossorigin="anonymous"
		/>

		<!-- Bootstrap Icons -->
		<link
			rel="stylesheet"
			href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
		/>

		<!-- Devicons -->
		<link
			rel="stylesheet"
			href="https://cdn.jsdelivr.net/gh/devicons/devicon@v2.15.1/devicon.min.css"
		/>

		<!-- Prism CSS -->
		<link rel="stylesheet" href="/css/prism.css" />
		<!-- CSS Themes -->
		<link rel="stylesheet" href="/css/themes.css" />

		<!-- Custom CSS -->
		<link rel="stylesheet" href="/css/site.css" />

		<!-- Favicon -->
		<link
			rel="shortcut icon"
			href="/img/favicon_io/favicon.ico"
			type="image/x-icon"
		/>
	</head>
	<body data-fyard-theme="purple">
		<header>
			<nav class="navbar navbar-expand-lg navbar-dark">
				<div class="container">
					<a class="navbar-brand" href="/index.html">
						<img
							src="/img/logos/logo-bulb1.png"
							height="40"
							alt="Site logo"
						/>
						RoyalLoanPlanner
					</a>
					<button
						class="navbar-toggler"
						type="button"
						data-bs-toggle="collapse"
						data-bs-target="#navbarSupportedContent"
						aria-controls="navbarSupportedContent"
						aria-expanded="false"
						aria-label="Toggle navigation"
					>
						<span class="navbar-toggler-icon"></span>
					</button>
					<div
						class="collapse navbar-collapse"
						id="navbarSupportedContent"
					>
						<ul class="navbar-nav ms-auto mb-2 mb-lg-0">
							<li class="nav-item">
								<a
									class="nav-link"
									aria-current="page"
									href="/index.html"
									>Home</a
								>
							</li>
							<li class="nav-item">
								<a class="nav-link" href="/app.html">The App</a>
							</li>
							<li class="nav-item">
								<a class="nav-link active" href="/code.html"
									>The Code</a
								>
							</li>
							<li class="nav-item">
								<!-- CHANGE ME!!!!!!!! -->
								<a class="nav-link" 
                                    href="https://github.com/fyardlest1/royal-loan-planner"
                                    target="_blank">The Repo</a>
							</li>
							<li class="nav-item">
								<a
									class="nav-link"
									href="https://fyardlest.net"
									target="_blank"
									referrerpolicy="no-referrer"
									>Portfolio</a
								>
							</li>
							<li class="nav-item">
								<!-- CHANGE ME!!!!!!!! -->
								<a class="nav-link" href="#">The Blog</a>
							</li>
						</ul>
					</div>
				</div>
			</nav>
		</header>

		<main class="container py-3">
			<h1 class="border-bottom border-dark">The Code</h1>
			<div class="row">
				<!-- JavaScript Code -->
				<div class="col-12 col-lg-8">
					<pre class="line-numbers">
                        <code class="language-js">
                            // Get the values from the user
							function getValues() {
								// get the values from the user
								let amount = document.getElementById('loan').value
								let term = document.getElementById('term').value
								let interest = document.getElementById('interestRates').value

								// convert the values to integers
								amount = parseFloat(amount)
								term = parseInt(term)
								interest = parseFloat(interest)

								// chek if the numbers are valid numbers
								if (isNaN(amount) || isNaN(term) || isNaN(interest)) {
									Swal.fire({
										icon: 'error',
										title: 'Oops!',
										text: '....',
										backdrop: false,
									})
								} else {
									let allPayment = totalPayment(amount, interest, term)
									displayCard(allPayment)
									let monthlyAmount = totalMonthlyPayment(amount, interest, term, allPayment.payment)
									displayTable(monthlyAmount)
								}	
							}

							// interest rate
							function interestRates(rate) {
								let interest = rate / 1200
								return interest
							}

							// claculate the monthly payment
							function totalPayment(amount, rate, term) {
								// the total monthly payment
								let payment =
									(amount * interestRates(rate)) /
									(1 - (1 + interestRates(rate)) ** -term)

								// the total cost
								let totalCost = payment * term
								// the total interest
								let totalInterest = totalCost - amount

								// create a new object with the value
								let payments = {
									amount: amount,
									payment: payment,
									interestRate: totalInterest,
									cost: totalCost
								}

								// returning the object
								return payments
							}

							// calculate result for each month
							function totalMonthlyPayment(amount, rate, term, monthlyPayment) {
								// creating an empty array to hold the objects
								let resultsArray = [] 
								// the remaining balance
								let remainingBalance = amount
								let totalInterest = 0

								// iterate through the months and make calculation
								for (let month = 1; month <= term; month++) {
									// interest to pay
									let interest = remainingBalance * interestRates(rate)
									let amountPayment = monthlyPayment - interest
									totalInterest += interest
									// update the balance for the next iteration
									remainingBalance -= amountPayment
									// allways return a positiv number of the remaining balance
									// using the absolute amount
									remainingBalance = Math.abs(remainingBalance)

									// create a new object with the data
									let paymentObj = {
										month,
										monthlyPayment,
										interest,
										amountPayment,
										totalInterest,
										remainingBalance,
									}
									// add the new object in the array
									resultsArray.push(paymentObj)
								}

								return resultsArray
							}

							// displaying the card information
							function displayCard(payments) {
								// format number to US dollar
								let USDollar = new Intl.NumberFormat('en-US', {
									style: 'currency',
									currency: 'USD',
								})

								let monthlyPayment = USDollar.format(payments.payment)
								let amount = USDollar.format(payments.amount)
								let interest = USDollar.format(payments.interestRate)
								let totalCost = USDollar.format(payments.cost)

								// add the value to the card
								document.getElementById('monthly-payment').textContent = monthlyPayment
								document.getElementById('principal').textContent = amount
								document.getElementById('interest').textContent = interest
								document.getElementById('cost').textContent = totalCost
							}

							// display the payment details per month
							function displayTable(results) {
								// format number to US dollar
								let USDollar = new Intl.NumberFormat('en-US', {
									style: 'currency',
									currency: 'USD',
								})

								// clean up the screen
								document.getElementById('tblResult').innerHTML = ''
								// get a copy of the template
								let template = document.getElementById('table-template')

								// getting the div id "tblResult"
								let tableData = document.getElementById('tblResult')

								// the arrow function that return the template
								results.forEach((newItem) => {
									let templateCopy = template.content.cloneNode(true)

									templateCopy.querySelector('.month').textContent = newItem.month
									templateCopy.querySelector('.payment').textContent = USDollar.format(
										newItem.monthlyPayment
									)
									templateCopy.querySelector('.principal').textContent = USDollar.format(
										newItem.amountPayment
									)
									templateCopy.querySelector('.interest').textContent = USDollar.format(
										newItem.interest
									)
									templateCopy.querySelector('.totalInterest').textContent =
										USDollar.format(newItem.totalInterest)
									templateCopy.querySelector('.balance').textContent = USDollar.format(
										newItem.remainingBalance
									)

									tableData.appendChild(templateCopy)
								})
							}
                        </code>
                    </pre>
				</div>
				<!-- Code explanation -->
				<div class="col-12 col-lg-4">
					<p>The code is structured in one fonction</p>
					<h5>
						<code>displayMessage()</code>
					</h5>
					<p>
						The <code>displayMessage</code> function gets the text
						from the input and display it in a Sweet Alert popup.
					</p>
					<h5>
						That's kind of cool, right?
						<span class="fs-4">&#128526;</span>
					</h5>
				</div>
			</div>
		</main>

		<footer class="py-3 container-fluid">
			<div class="container">
				<div
					class="row row-cols-1 row-cols-lg-3 align-items-center gy-2"
				>
					<div
						class="col text-center text-md-start order-last order-lg-first text-lg-start"
					>
						&copy;2024 Yardley Estiverne
					</div>
					<div class="col text-center">
						<img
							src="/img/logos/logo-light-text-block.png"
							height="50"
							alt=""
						/>
					</div>
					<div class="col text-center text-lg-end">
						<a
							href="https://www.linkedin.com/in/fyardlest/"
							target="_blank"
							class="text-decoration-none"
						>
							<i class="bi bi-linkedin p-2"></i>
						</a>
						<a
							href="https://github.com/fyardlest1"
							target="_blank"
							class="text-decoration-none"
						>
							<i class="bi bi-github p-2"></i>
						</a>
						<a
							href="mailto:y.estiverne@yahoo.fr"
							class="text-decoration-none"
						>
							<i class="bi bi-envelope-at p-2"></i>
						</a>
						<a
							href="https://twitter.com/fyardlest"
							target="_blank"
							class="text-decoration-none"
						>
							<i class="bi bi-twitter p-2"></i>
						</a>
						<a href="#" class="text-decoration-none">
							<i class="bi bi-youtube p-2"></i>
						</a>
					</div>
				</div>
			</div>
		</footer>

		<!-- Bootstrap Script -->
		<script
			src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
			integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
			crossorigin="anonymous"
		></script>

		<!-- Prism JS -->
		<script src="js/prism.js"></script>
		<script>
			Prism.plugins.NormalizeWhitespace.setDefaults({
				'remove-trailing': true,
				'remove-indent': true,
				'left-trim': true,
				'right-trim': true,
			})
		</script>
	</body>
</html>
