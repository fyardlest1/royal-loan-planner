<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>RoyalLoanPlanner: A coding Challenge</title>

		<!-- Bootstrap CSS -->
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
			rel="stylesheet"
			integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
			crossorigin="anonymous"
		/>

		<!-- Bootstrap Icons -->
		<link
			rel="stylesheet"
			href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
		/>

		<!-- Devicons -->
		<link
			rel="stylesheet"
			href="https://cdn.jsdelivr.net/gh/devicons/devicon@v2.15.1/devicon.min.css"
		/>

		<!-- Prism CSS -->
		<link rel="stylesheet" href="/css/prism.css" />
		<!-- CSS Themes -->
		<link rel="stylesheet" href="/css/themes.css" />

		<!-- Custom CSS -->
		<link rel="stylesheet" href="/css/site.css" />

		<!-- Favicon -->
		<link
			rel="shortcut icon"
			href="/img/favicon_io/favicon.ico"
			type="image/x-icon"
		/>
	</head>
	<body data-fyard-theme="purple">
		<header>
			<nav class="navbar navbar-expand-lg navbar-dark">
				<div class="container">
					<a class="navbar-brand" href="/index.html">
						<img
							src="/img/logos/logo-bulb1.png"
							height="40"
							alt="Site logo"
						/>
						RoyalLoanPlanner
					</a>
					<button
						class="navbar-toggler"
						type="button"
						data-bs-toggle="collapse"
						data-bs-target="#navbarSupportedContent"
						aria-controls="navbarSupportedContent"
						aria-expanded="false"
						aria-label="Toggle navigation"
					>
						<span class="navbar-toggler-icon"></span>
					</button>
					<div
						class="collapse navbar-collapse"
						id="navbarSupportedContent"
					>
						<ul class="navbar-nav ms-auto mb-2 mb-lg-0">
							<li class="nav-item">
								<a
									class="nav-link"
									aria-current="page"
									href="/index.html"
									>Home</a
								>
							</li>
							<li class="nav-item">
								<a class="nav-link" href="/app.html">The App</a>
							</li>
							<li class="nav-item">
								<a class="nav-link active" href="/code.html"
									>The Code</a
								>
							</li>
							<li class="nav-item">
								<!-- CHANGE ME!!!!!!!! -->
								<a class="nav-link" 
                                    href="https://github.com/fyardlest1/royal-loan-planner"
                                    target="_blank">The Repo</a>
							</li>
							<li class="nav-item">
								<a
									class="nav-link"
									href="https://fyardlest.net"
									target="_blank"
									referrerpolicy="no-referrer"
									>Portfolio</a
								>
							</li>
							<li class="nav-item">
								<!-- CHANGE ME!!!!!!!! -->
								<a class="nav-link" href="#">The Blog</a>
							</li>
						</ul>
					</div>
				</div>
			</nav>
		</header>

		<main class="container py-3">
			<h1 class="border-bottom border-dark">The Code</h1>
			<div class="row">
				<!-- JavaScript Code -->
				<div class="col-12 col-lg-8">
					<pre class="line-numbers">
                        <code class="language-js">
                            function getValues() {
								// get the values from the user
								let amount = document.getElementById('loan').value;
								let monthlyTerm = document.getElementById('term').value;
								let interest = document.getElementById('interestRates').value;

								// convert the values to integers
								amount = parseInt(amount)
								monthlyTerm = parseInt(monthlyTerm)
								interest = parseInt(interest)	

								let results = {
									loan: amount,
									term: monthlyTerm,
									interest: interest,
								}

								let totalPayment = {
									payment: monthlyPayment(results),
									interest: interestPayment(results),
									principal: principalPayment(results)
								}

								// let payment = monthlyPayment(results)
								// let rate = interestPayment(results)
								displayCard(totalPayment)
								totalMonthlyPayment(results, totalPayment)
								displayTable(results, totalPayment)
							}

							// total payment 
							// Formula: (amount loaned) * (rate / 1200) / ( 1 - (1 + rate/1200)^(-Number of Months) )
							// 25000 * (5 / 1200) / (1 - (1 + 5/1200)^(-60))

							// total interest
							function interestRates(rate) {	
								let interest = (rate / 1200)
								return interest
							}

							// claculate the monthly payment
							function monthlyPayment(results) {
								let payment =
									(results.loan * interestRates(results.interest)) /
									((1 - (1 + interestRates(results.interest))** -results.term))

								payment = Math.round(payment * 100) / 100
								return payment
							}

							// calculate the interest to pay base on the amount
							// Interest Payment = Previous Remaining Balance * rate/1200
							function interestPayment(results) {
								let interest = results.loan * interestRates(results.interest)
								interest = Math.round(interest * 100) / 100
								return interest
							}

							// Principal Payment = Total Monthly Payment - Interest Payment
							function principalPayment(results) {
								let totalMonthlyPayment = parseFloat(monthlyPayment(results));
								let interest = parseFloat(interestPayment(results));

								// calculate the principal
								let principal = totalMonthlyPayment - interest
								principal = Math.round(principal * 100) / 100
								return principal
							}
							
							// calculate result for each month
							function totalMonthlyPayment(results, totalPayment) {
								// creating an empty array to hold the objects
								let resultsArray = []

								let payment = totalPayment.payment
								let principal = totalPayment.principal
								let interest = totalPayment.interest
								let balance = results.loan
								let totalInterest = interest

								// iterate through the months and make calculation
								for (let i = 0; i < results.term; i++) {
									// the remaining balance
									balance = results.loan - principal
									// creating a new object for each iteration
									let resultsObject = {
										month: i + 1,
										payment: totalPayment.payment,
										principal: Math.round(principal * 100) / 100,
										interest: Math.round(interest * 100) / 100,
										balance: Math.round(balance * 100) / 100,
										totalInterest: Math.round(totalInterest * 100) / 100,
									}

									// calculating the principal and interest
									interest = balance * interestRates(results.interest)
									principal = payment - interest
									totalInterest += interest
									
									// update the loan for the next iteration
									results.loan = balance


									// add the new object in the array
									resultsArray.push(resultsObject)
								}

								return resultsArray
							}

							// displaying the card information
							function displayCard(totalPayment) {
								// clean up the screen
								document.getElementById('paymentResults').innerHTML = ''
								// get a copy of the template
								let template

								// access the template
								template = document.getElementById('card-template')
								// get a new copy of the template's contents
								let templateCopy = template.content.cloneNode(true)

								// put the original message into the card
								templateCopy.querySelector(
									'.monthly-payment'
								).textContent = `$${totalPayment.payment}`
								templateCopy.querySelector(
									'.principal'
								).textContent = `$${totalPayment.payment}`
								templateCopy.querySelector(
									'.interest'
								).textContent = `$${totalPayment.interest}`
								templateCopy.querySelector('.cost').textContent = `$${totalPayment.principal}`

								// add the copy of the template tag to the div element with the ID: 'paymentResults'
								document.getElementById('paymentResults').appendChild(templateCopy)
							}


							function displayTable(results, totalPayment) {
								// get a copy of the template
								let template

								// access the totalMonthlyPayment(results, totalPayment)
								let resultsArray = totalMonthlyPayment(results, totalPayment)
								// Iterate through the resultsArray
								template = document.getElementById('table-template')
								// get a new copy of the template's contents
								let templateCopy = template.content.cloneNode(true)

								for (let i = 0; i < resultsArray.length; i++) {
									let newItem = resultsArray[i]
									templateCopy.querySelector('.month').textContent = newItem.month
									templateCopy.querySelector('.payment').textContent = newItem.payment
									templateCopy.querySelector('.principal').textContent = newItem.principal
									templateCopy.querySelector('.interest').textContent = newItem.interest
									templateCopy.querySelector('.totalInterest').textContent =
										newItem.totalInterest
									templateCopy.querySelector('.balance').textContent = newItem.balance

									// add our copy of the template tag to the div id "tblResult"
									document.getElementById('tblResult').appendChild(templateCopy)
								}
							}
                        </code>
                    </pre>
				</div>
				<!-- Code explanation -->
				<div class="col-12 col-lg-4">
					<p>The code is structured in one fonction</p>
					<h5>
						<code>displayMessage()</code>
					</h5>
					<p>
						The <code>displayMessage</code> function gets the text
						from the input and display it in a Sweet Alert popup.
					</p>
					<h5>
						That's kind of cool, right?
						<span class="fs-4">&#128526;</span>
					</h5>
				</div>
			</div>
		</main>

		<footer class="py-3 container-fluid">
			<div class="container">
				<div
					class="row row-cols-1 row-cols-lg-3 align-items-center gy-2"
				>
					<div
						class="col text-center text-md-start order-last order-lg-first text-lg-start"
					>
						&copy;2024 Yardley Estiverne
					</div>
					<div class="col text-center">
						<img
							src="/img/logos/logo-light-text-block.png"
							height="50"
							alt=""
						/>
					</div>
					<div class="col text-center text-lg-end">
						<a
							href="https://www.linkedin.com/in/fyardlest/"
							target="_blank"
							class="text-decoration-none"
						>
							<i class="bi bi-linkedin p-2"></i>
						</a>
						<a
							href="https://github.com/fyardlest1"
							target="_blank"
							class="text-decoration-none"
						>
							<i class="bi bi-github p-2"></i>
						</a>
						<a
							href="mailto:y.estiverne@yahoo.fr"
							class="text-decoration-none"
						>
							<i class="bi bi-envelope-at p-2"></i>
						</a>
						<a
							href="https://twitter.com/fyardlest"
							target="_blank"
							class="text-decoration-none"
						>
							<i class="bi bi-twitter p-2"></i>
						</a>
						<a href="#" class="text-decoration-none">
							<i class="bi bi-youtube p-2"></i>
						</a>
					</div>
				</div>
			</div>
		</footer>

		<!-- Bootstrap Script -->
		<script
			src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
			integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
			crossorigin="anonymous"
		></script>

		<!-- Prism JS -->
		<script src="js/prism.js"></script>
		<script>
			Prism.plugins.NormalizeWhitespace.setDefaults({
				'remove-trailing': true,
				'remove-indent': true,
				'left-trim': true,
				'right-trim': true,
			})
		</script>
	</body>
</html>
